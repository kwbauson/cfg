name: Build
on: { workflow_dispatch, push: { branches: [main] }, pull_request }
jobs:
  build:
    runs-on: [nix, Linux, X64]
    steps:
      - uses: actions/checkout@v3
      - run: nix -vL --show-trace build
      - run: cachix authtoken '${{ secrets.CACHIX_AUTH_TOKEN }}'
      - run: cachix push kwbauson result
  macos-checks:
    runs-on: [nix, macOS, ARM64]
    steps:
      - uses: actions/checkout@v3
      - run: nix -vL --show-trace build
      - run: cachix authtoken '${{ secrets.CACHIX_AUTH_TOKEN }}'
      - run: cachix push kwbauson result
