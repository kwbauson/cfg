name: updates
run-name: updates-${{ inputs.source }}
on:
  workflow_dispatch:
    inputs:
      source: { type: string, default: all, required: true }
  schedule: [cron: '0 7 * * *']
jobs:
  updates:
    name: updates-${{ inputs.source }}
    runs-on: [nix, Linux, X64]
    env:
      GITHUB_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
    steps:
      - uses: actions/checkout@v3
      - run: nix run .#updates.${{ inputs.source }}
      - uses: peter-evans/create-pull-request@v5
        id: cpr
        with:
          author: Keith Bauson <kwbauson@gmail.com>
          title: '${{ inputs.source }}: update'
          commit-message: '${{ inputs.source }}: update'
          branch: updates-${{ inputs.source }}
          delete-branch: true
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
      - if: ${{ steps.cpr.outputs.pull-request-number }}
        run: gh pr merge --auto --squash ${{ steps.cpr.outputs.pull-request-url }}
